## 使用session保存用户名：
需求：   
注册成功后自动登录；   
登录后记住用户状态，并在多个页面显示用户名；   
### 实现方法：
这个效果的实现是使用了一个叫session的内置对象，这个内置对象也被称为"会话";   
### 什么是会话：
会话就是当我们使用浏览器访问服务器的时候，与服务器产生的通话；   
使用会话可以让我们在使用浏览器与服务器进行的多次请求中保存和使用数据；   

### 实现思路：
首先，注册成功后，可以在session中保存一个与你相关的标志，比如说你的用户名；然后可以跳转到其他页面，在其他页面中来检查一下，session是否有与你相关的标志；    
如果有的话，表明你的身份已经得到认证了，可能是"登录成功"或是"注册成功";这时，就可以从session中把你的用户名取出来显示；    
在session中保存数据和获取数据的语法格式很简单，与在request中保存数据很像；      
保存数据的时候使用setAttribute方法；      
语法：   
```
public void setAttribute(String name,Object value);
```
方法的参数name表示属性名，参数value表示属性值；    
示例：    
```
session.setAttribute("userName","张三丰");
```
把"张三丰"这个值，用"userName"这个属性名存入session；   

要从session中获取数据，使用方法getAttribute；    
语法：
```
public Object getAttribute(String name);
```
这个方法用于指定属性名，返回值就是取出的属性值；   
注意：    
这个返回值是Object类型的，所以我们在使用的时候是要做数据类型转换的；   
示例：   
```
取出"张三丰"：     
String userName=(String)session.getAttribute("userName");
```
### session工作方式：
会话的数据其实是被保存在服务器端的，访问服务器会有很多的用户，所以服务器端会保存很多的会话；   
那么，服务器是怎样在这么多的会话中正确的认识你的会话的：    
每个session都有一个唯一的id，叫：sessionid；    
这个sessionid是服务器产生的，产生后就会随着响应发到你的浏览器，你的浏览器会记住这个sessionid；    
以后再向服务器发送请求的时候会带着这个sessionid；     
服务器如果从请求中拿到这个sessionid的话，就可以从服务器端找出与你这个sessionid相对应的session，从而实现针对于你的数据存取；    
可以使用 `session.getId()`; 方法来查看sessionid；    
这个方法会以String的方式返回sessionid；     


##### 会话清除与过期：
session的数据是在服务器端保存的，如果没有一种适当的清理机制的话，服务器保存的会话数据量会越来大，导致性能问题甚至是服务器崩溃；所以，服务器端必须要有一种合理的清除会话的机制；    
对于服务器而言，有两种清除数据的方式：   
- 一，程序主动请求清除session数据，比如登录以后的"注销"功能；
使用语句：   
```
session.invalidate();
```
设置会话失效；    
如果不想清除这个会话，仅想移除会话中的某个属性的话；使用session对象的removeAttribute方法；     

移除会话中的一个属性：    
语法：   
```
public void removeAttribute(String name);
```
这个方法的参数name指定的是"属性名"；   
示例：    
在session中移除"userName"属性：   
```
session.removeAttribute("userName");
```
- 二，服务器会主动的清除长时间没有再次请求的session；  
设置会话过期的时候；    
我们可以设置一个时间；如果用户在指定的时间内没有再次请求服务器的话，服务器就会主动的清除这个session，以释放数据；   
我们设置的这个时间，被称为会话过期时间；    
有两种方法可以设置会话的过期时间：    
方法一：   
```
public void setMaxInactiveInterval(int interval);
```
方法的参数是interval，指定的是会话过期的秒，如果在指定的秒数以内；客户端没有再次发出请求的话，这个会话会在服务器端被清除；    

方法二：   
在web.xml中设置所有session的过期时间；   
设置方法：   
```
在web.xml中加入这段代码：
<session-config><session-timeout>过期时间</session-timeout></session-config>
其中<session-timeout>里设置的数值时分钟值；
```
因为客户端浏览器会记住sessionid，如果浏览器被关闭的话，客户端的sessionid会丢失，此时服务器端会在会话到期时清除这个对应的session；  


### 小结：
session通常被称为"会话"，它与我们平时打电话使用电话银行或者是使用10086自助服务台很像；   
打出电话相当于用浏览器访问了服务器，产生了一次会话；    
电话办理业务的时候往往需要输入服务的密码，相当于通过浏览器在网站登录，都是为了实现用户验证后保存用户的信息；   
之后的访问都会识别出这个用户，相当于登录成功后就可以用个人身份进行访问；在会话有效期内；   
挂断电话相当于关闭了浏览器，都是结束了本次的会话；    
打通10086自助服务台后，如果长时间没有按键操作的话，   
对方会自动挂断，结束会话；同样，如果长时间没有通过浏览器再次请求服务器，服务器也会主动结束会话；会话到期；   
其实，这样做会降低服务器开销，合理的使用服务器资源，这就需要我们合理的设置会话有效期，不能过长，无谓的加大了服务器的负担；但，也不能过短，使会话数据频繁失效，"逼迫"用户频繁的操作；   
如果session中的数据如果不再需要了，可通过清除会话或者删除会话中的属性，及时释放资源；    
使用程序语句结束会话、会话到期都会使会话中的数据丢失；    


#### 使用cookie自动填写用户名：
问题一：    
浏览器关闭了，就结束会话了，服务器就不"认识"用户了，那为什么有些论坛我都关机了，再开机还能认识我，还算我已登录呢？

问题二：    
为什么我每次访问邮箱的时候，页面上就直接帮我填写好了用户名呢？   

其实这两个功能都使用了相同的实现方式，就是在cookie中保存数据；   
cookie是以文件的方式在客户端保存数据；   
在cookie中存放数据时使用：   
```
public void addCookie(Cookie cookie)
```

从cookie中取出数据使用：     
```
public Cookie[] getCookies()
```
##### 设置有效期：
cookie可以设置有效期，当cookie过期后，其中的数据将不再可用；  
设置cookie的有效期使用：   
```
public void setMaxAge(int expiry)
```
这个方法的参数expiry单位是 秒；   
cookie是在客户端以文件的方式保存的数据，如果有人窃取了这个cookie文件，就会暴露客户的隐私数据，所以并不是每个用户都喜欢cookie的；    
用户可以禁用： cookie；    


##### application实现计数器：
我们经常会看到，网站上的某个页面举办了什么活动，现在想了解该网页被访问的次数，也就是说，我想了解下多少人关注这个活动，应该怎么实现：   
分析实现：     
这里的访问次数是包含所有用户的；要实现这个功能要用到application对象；   
其实，每个web项目都会有一个application对象；   
application对象可在整个项目中共享使用数据；   
把页面的访问次数放这里就可以了；   
这个问题可以通过在application中保存计数器实现：    
每次访问这个页面的时候，让计数器加1；   
在application中存取数据使用的方法是setAttribute和getAttribute；  
```java
public void setAttribute(String name,Object object)
public Object getAttribute(String name)
```

### 三个对象的对比：
request、session和application对象，这三个对象都可以存储属性，那么，这三个对象的区别是：   
他们的主要区别在于有效的范围不一样；    
- request：   
request中存储的数据仅在一个请求中可用；   
它适用于需要存储的数据仅在一次请求中使用；   
比如：对于本次请求的结论性提示；   
当用户通过浏览器访问服务器上的A页面时在请求对象request中保存了数据，然后通过转发的方式跳转到了B页面，在B页面中是可以访问请求中携带的这个数据的；B页面执行完成后，会给浏览器以响应；这时浏览器再发出请求去访问A页面或者是其他的C页面的时候，刚才在请求中保存的数据将不可用；   

- Session：   
session中存储的数据在一个会话的有效期内可用；  
它适用于一次会话的多个页面中共享访问数据；    
比如：登录后需要存储的标志性数据；    
这样的数据是需要单用户在多页面中可访问的，而不需要多用户共享使用；   
当甲用户通过浏览器访问访问的A页面时，在甲用户对应的session中保存了数据；   
然后，甲用户再访问A页面或B页面时都可以从自己对应的session中再次访问到这个数据；    
当甲用户把浏览器关掉的时候，与甲用户相关的sessionid会丢失；所以，就算甲用户再次打开浏览器，也不会访问到自己之前session中保存的数据；     
每个用户都会有自己对应的session，保存的数据也不会相互干扰；    

- application：
application中存储的数据在整个web项目中可用   
application对象中存储的数据时效性是最长的；    
只要web服务不停止，在整个web项目中都是可使用的；   
它适用于存放要在整个web项目中共享访问的数据或多个用户都需要使用的数据；   
如：页面被访问的次数或同时在线的人数；    
如果甲用户通过浏览器访问服务器上的A页面的时候，在application中保存了数据；以后再访问A页面也好，B页面也好，都可以再次访问这个数据；就算甲用户把浏览器关掉了，下次只要重新打开浏览器再访问服务器上的页面时，也还是可以访问到application中存放的数据；     
而且，不光是甲用户可以访问，其他每个用户都可以访问；application中存放的数据只有当web服务停止的时候才会消失；它的存储时间较长，所以十分必要的数据，我们才会考虑把它存储到application中；     